## 브로드캐스팅 이란?

두 가지의 행렬이 있을때, 행렬간의 matrix shape이 맞지 않는경우 ,
shape을 맞추기 위해 **가상적으로 복제하는 방법**을 말한다. 

## 브로드캐스팅이 쓰이는 경우

1. **성분별(element-wise) 연산**
    - `+`, ``, ``, `/`, `*`, `np.sin`, `np.exp`, `np.where`, …
    - 배열 간 크기가 달라도 (브로드캐스팅 규칙이 성립하면) 자동으로 확장되어 계산.
2. **행렬 곱(`@`, `np.matmul`)**
    - 마지막 두 축(행렬 곱 규칙)은 (m,n)×(n,k)이 맞아야 하고, 그 **앞쪽(배치) 차원**들은 서로 브로드캐스팅 규칙으로 확장.
    - “**마지막 두 축**”은 ‘행렬 곱 규칙’ + **앞쪽 축**은 ‘브로드캐스팅 규칙’” 이라는 조합된 제약이 있다.
    - 예) `(1, 3, 2) @ (3, 2, 4)` → 앞쪽 배치 차원 (1 vs 3) 브로드캐스팅 가능 → 결과 `(3, 3, 4)`.
3. **그 외 여러 NumPy 내장 함수**
    - 예) `np.add(a, b)`, `np.maximum(a, b)`, `np.sqrt(a)`, 등등, 내부적으로 element-wise 처리가 이뤄지는 대부분의 함수가 자동으로 브로드캐스팅을 이용.

## 브로드캐스팅이 가능한 조건

1. (easy) 두 차원이 같을때 → 그대로 연산
2. (easy) 한쪽 배열이 아예 Scalar → 모든 원소에 Scalar가 적용됨 
3. 한 쪽이 1 → 1인 차원이 큰 Dim으로 [**확장**]됨 (ex. (2,3) and (3,))  ~~or 행 개수가 같거나?~~
4. (hard) 아예 자동 브로드캐스팅이 불가할때 (ex. (2,5) and (3,3))
    - 마지막 축도 다르고, 그 윗축(2, 3)도 서로 1이 아니므로
    
    차원이 부족해서 브로드캐스팅이 불가능한 경우
    

## 브로드캐스팅이 어떻게 확장되는가?

<aside>
💡

브로드캐스팅은 실제 데이터 복사가 일어나지 않는다. **가상적**으로 변환되어 실제 메모리 복사가 없음.

</aside>

1. **(3번 조건 예제)** 1D vs 2D broadcasting 
    
    ```python
    a = np.array([1,2,3],[4,5,6]) # (2,3)
    b = np.array([10,11,12]) # (3,) -> (2,3)으로 *가상* 확장됨 
    # a+b 가능 / a @ b.T 가능
    ```
    
    ```
    A (2x3): 
    [[1 2 3]
     [4 5 6]]
    B (1x3) -> **(2x3) (가상 확장됨)**: 
    ([10,11,12],
    [10,11,12])
    ```
    
2. **(3번 조건 예제)** 1D vs 3D broadcasting
    
    ```python
    a = np.array([1,2,3]) # (3,)
    b = np.array([[[10]],[[20]]]) #(2,1,1)
    ```
    
    ```
    (3,) -> (1,3) -> (1,1,3) 로 가상확장
    (2,1,1) -> (2,1,3)로 가상확장
    ```
    
3. **(4번 조건 예제) 두 배열이 다른 차원을 가지고 있을때, 자동 확장이 불가능할때** 
    
    ```python
    arr1 = np.random.randint(10)
    arr2 = np.random.rand(10)
    arr1 = arr1.reshape(3,3) # (3,3)
    arr2 = arr2.reshape(2,5) # (2,5)
    
    arr1 = arr1.flatten() # (9,)
    arr2 = arr2.flatten() # (10,)
    
    arr2 = arr2[:,np.newaxis] # (10,1)
    
    10x1 * 1x9 -> 10x9
    ```
    

## 주의사항

<aside>
💡

**브로드캐스팅 작업이 논리적으로 맞을까?**

✅ 1. 브로드캐스팅이 논리적으로 타당한 경우

- 하나의 벡터를 모든 행에 동일하게 적용하고 싶은 경우
- 데이터의 의미가 모든 행에서 동일하게 적용되고 싶은 경우

✅ 2. 브로드캐스팅이 논리적으로 틀린 경우

- A의 행돌이 모두 독립적인 의미를 갖는다면, B를 강제로 모든 행에 복제하는 것은 틀린 논리!
</aside>